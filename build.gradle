/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.10.2/userguide/java_library_plugin.html
 */
apply plugin: 'java'

version = '1.0'
ext.rundeckVersion = '2.6.9'
ext.rundeckPluginVersion= '1.1'
ext.pluginClassNames = 'com.lostinthebox.rundeck.plugin.webex.WebExTeamsNotificationPlugin'

configurations{
    //declare custom pluginLibs configuration to include only libs for this plugin
    pluginLibs

    //declare implementation to extend from pluginLibs so it inherits the dependencies
    implementation {
        extendsFrom pluginLibs
    }
}

repositories {
    /* com.ciscospark:ciscospark-client:1.0-SNAPSHOT is installed in local
     * maven repository
     */
    mavenLocal()
    mavenCentral()
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    implementation group: 'org.rundeck', name: 'rundeck-core', version: rundeckVersion
    pluginLibs 'com.ciscospark:ciscospark-client:1.0-SNAPSHOT'
    pluginLibs 'org.freemarker:freemarker:2.3.28'
    pluginLibs 'org.glassfish:javax.json:1.0.4'
}

// task to copy plugin libs to output/lib dir
task copyToLib(type: Copy) {
    from configurations.pluginLibs
    into "$buildDir/output/lib"
}

task copyLicense(type: Copy) {
    from "LICENSE"
    into "$buildDir/output"
}

jar {
    //include contents of output dir
    from "$buildDir/output"
    manifest {
        attributes 'Rundeck-Plugin-Classnames': pluginClassNames
        attributes 'Rundeck-Plugin-File-Version': version
        attributes 'Rundeck-Plugin-Version': rundeckPluginVersion
        attributes 'Rundeck-Plugin-Archive': 'true'

        //create space-separated list of pluginLibs
        def libList = configurations.pluginLibs.collect{'lib/'+it.name}.join(' ')
        attributes 'Rundeck-Plugin-Libs': "${libList}"
    }
}

jar.dependsOn(copyToLib, copyLicense)
